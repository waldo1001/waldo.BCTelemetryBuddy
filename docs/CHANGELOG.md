CHANGELOG
=========

This changelog tracks all changes to the project. **Latest entries are at the top** (reverse chronological order). Manual edits are allowed for retrospective notes but prefer PR-driven updates for production releases.

Recent entries
--------------
- 2025-10-16 01:30 — Created dedicated E2E test script for GitHub Copilot integration — User requested: "I want to start testing from GitHub copilot. Write me an End-to-end testscript for manual testing with GitHub copilot"; created comprehensive E2E-Copilot-TestScript.md as PRIMARY test document; 10 test parts covering complete Copilot workflow: setup verification, MCP tools registration (`@workspace /` command), basic telemetry queries with conversational follow-ups, saved queries management via Copilot, query search/discovery, recommendations, complex multi-step workflows (analysis/comparison/investigation with tool chaining), error handling (invalid queries/no results/ambiguous requests/auth failures), integration with saved queries as context, natural language flexibility testing (formal/casual/technical/business phrasings); includes success criteria checklist (Critical/Important/Nice-to-have), troubleshooting section with PowerShell debug commands, test results summary table, detailed expected behaviors; emphasizes throughout: "If natural language telemetry queries don't work smoothly through Copilot Chat, the project hasn't achieved its goal"; goal: "Show me errors from yesterday should just work in Copilot Chat" (chat-driven)
- 2025-10-16 01:25 — Clarified GitHub Copilot integration as PRIMARY use case in E2E test documentation — User corrected critical misunderstanding: "That integration is not optional. It's actually the very reason of the existence of this workspace...If it doesn't work through github copilot, this project is lost"; entire project exists to provide MCP tools to GitHub Copilot Chat for natural language telemetry queries; Command Palette functionality only for testing/debugging; updated E2E-TestScript.md Part 10 title from "Optional" to "PRIMARY USE CASE" with critical warning; expanded Part 10 from 5 to 8 comprehensive tests (multi-step workflows, error handling, complex scenarios); reorganized success criteria into "CRITICAL (Project Purpose)" vs "Infrastructure" vs "Testing Only" sections with bold emphasis Copilot must work; added notes to Parts 4-6 clarifying Command Palette is testing-only; updated conclusion with conditional next steps (Part 10 passes = proceed to publish, Part 10 fails = STOP and debug); emphasized Copilot integration is entire project purpose (chat-driven)
- 2025-10-16 01:20 — Updated E2E test script for new queries folder structure — After implementing workspace root queries folder, E2E-TestScript.md sections 5.1, 5.2, and 6.1/6.2 needed updates; changed expected paths from `.vscode/.bctb/queries/Recent Errors.kql` to `queries/Monitoring/Recent Errors.kql` with category subfolders; added category prompt step in save query workflow; updated expected KQL file content to include Category comment; changed "Open Queries Folder" path to workspace root `queries/`; added version control guidance (queries/ committed, .vscode/.bctb/cache/ gitignored); updated manual query creation to show category subfolder structure (chat-driven)
- 2025-10-16 01:15 — Moved saved queries from `.vscode/.bctb/queries/` to workspace root `queries/` folder with category support — User realized saved queries should be version-controlled source code, not hidden in .vscode folder; user said "the idea of 'save query' is to build some kind of codebase...create subfolders as 'namespaces' or categories"; queries now organized in `queries/[Category]/[QueryName].kql` structure; MCP: added category field to SavedQuery interface, made QueriesService constructor accept configurable queriesFolder param (defaults to 'queries'), implemented recursive scanDirectory() for subfolder scanning, updated getAllQueries() to scan recursively, added category extraction from folder path, updated saveQuery() to accept optional category param and create subfolders, added getCategories() method, updated config/server to support queriesFolder setting and get_categories RPC method; Extension: added bctb.queries.folder setting (default 'queries'), updated buildMCPEnvironment() to pass BCTB_QUERIES_FOLDER, updated saveQueryCommand() to fetch/suggest categories and prompt user, updated SaveQueryRequest interface for category field, added MCPClient.request() generic method, updated openQueriesFolderCommand() to use configured folder; queries now version-controlled, team-shareable, discoverable, with namespace organization (chat-driven)
- 2025-10-16 00:20 — Added Azure CLI authentication flow using cached credentials — User had to re-authenticate every MCP restart (device_code tokens not persisted); user asked about using 'az login' cached credentials; added new 'azure_cli' auth flow that executes `az account get-access-token --resource https://api.applicationinsights.io` via child_process to retrieve cached token; parses JSON response for accessToken/subscription/tenant/expiresOn; added helpful errors if Azure CLI not installed or user not logged in; updated config validation to skip tenantId for azure_cli (uses current az session); changed default authFlow to 'azure_cli'; updated extension settings enum and descriptions; users with `az login` now authenticate seamlessly without browser prompts on every restart (chat-driven)
- 2025-10-16 00:15 — Added VS Code notification for device code authentication — Device code message only appeared in output channel requiring manual copy/paste; user requested notification with browser button and auto-clipboard; added handleDeviceCodeMessage() that parses MCP stdout for device code patterns, automatically copies code to clipboard, shows VS Code notification with "Open Browser" button that opens https://microsoft.com/devicelogin; single-click authentication workflow (chat-driven)
- 2025-10-16 00:10 — Fixed extension webview null-safety error — Query executed successfully in MCP but extension failed to render results with "Cannot read properties of null (reading 'replace')" error; resultsWebview.escapeHtml() assumed all inputs were strings but Application Insights results contained null/undefined column values; modified escapeHtml() to accept string | null | undefined, added null check returning empty string, wrapped text with String() before replace(); webview now displays query results successfully (chat-driven)
- 2025-10-16 00:02 — Fixed Application Insights API endpoint URL — Query execution failed with "Kusto query failed (404): unknown key 'v1' in path" because KustoService concatenated clusterUrl (containing /subscriptions/...) with /v1/apps/.../query creating invalid path; changed executeQuery() to use correct hardcoded endpoint https://api.applicationinsights.io/v1/apps/{appId}/query; clusterUrl setting now ignored (only appId needed); queries execute successfully against correct API (chat-driven)
- 2025-10-15 23:18 — Fixed device code authentication: Use Azure CLI public client ID — Device code flow failed with "invalid_grant" and showed "undefined" for device code message because auth.ts used placeholder clientId 'default-client-id'; changed authenticateDeviceCode() to use Azure CLI's well-known public client ID (04b07795-8ddb-461a-bbee-02f9e1bf7b46) as fallback; this is Microsoft's official public client ID for device code scenarios; users can override via BCTB_CLIENT_ID env var; device code now works without user registering Azure AD app (chat-driven)
- 2025-10-15 23:16 — Fixed MCP authentication timing: Authenticate on startup — MCP never prompted for device code login because authentication was only triggered during query execution (too late for device_code flow); changed start() to async and added await auth.authenticate() immediately after server starts; device_code flow now shows browser login prompt BEFORE queries; client_credentials flow validates early and fails fast; server continues running even if auth fails (retry on first query); wrapped startup in async IIFE (chat-driven)
- 2025-10-15 23:13 — Fixed MCP natural language query handling — MCP query_telemetry handler crashed with "ERR_INVALID_ARG_TYPE: Received undefined" when extension sent `nl` parameter for natural language queries; added NL-to-KQL translation logic with basic keyword detection (table, time range, severity); implemented translateNLToKQL() method with context loading from saved queries and external references; fixed ExternalQuery type reference (content vs kql property); rebuilt MCP ready for E2E testing (chat-driven)
 - 2025-10-15 22:34 — Logged user prompt to PromptLog.md (Entry #59) — User reported that prompts were not being logged; appended the prompt to PromptLog.md and added a short DesignWalkthrough note to reference the change. (chat-driven)
 - 2025-10-15 22:32 — Fixed env var mapping between extension and MCP — The extension was passing environment variables with different names than the MCP config loader expected, causing the MCP to fail validation and exit early; updated extension env mapping to `BCTB_APP_INSIGHTS_ID`, `BCTB_KUSTO_URL`, `BCTB_CACHE_TTL`, and updated unit tests and logs. (chat-driven)

 - 2025-10-15 20:40 — Restructured CHANGELOG.md to reverse chronological order (latest first) — Reordered all entries so newest appear at top; updated header text and copilot-instructions.md to document that new entries must be inserted at TOP of "Recent entries" section; ensures most recent changes are always visible first (chat-driven)
- 2025-10-15 20:35 — Fixed all TypeScript and VSCode false positive errors — Root tsconfig: removed conflicting module settings, set default moduleResolution bundler; MCP: ES2022 + bundler (ESM); Extension: CommonJS + node10 (required for VSCode); both packages compile successfully; .vscode/settings.json: disabled MSBuild/OmniSharp/C#/Kusto validation, added file associations for markdown, excluded .github from watching; .markdownlint.json added; resolved 8 markdown false positives + 1 chat code block error; codebase has zero real problems (chat-driven)
- 2025-10-15 20:15 — Created VSCode launch and tasks configurations — Added .vscode/launch.json with 4 debug configurations (Run Extension, Watch Mode, Tests, Debug MCP) and compound launch for both; added .vscode/tasks.json with build/test tasks for monorepo; enables F5 debugging from workspace root (chat-driven)
- 2025-10-15 20:00 — Fixed CI build: vsce parent directory traversal — Added `../` and `../../` to .vscodeignore to prevent vsce from including workspace root and .git folder; reduced package from 627 files to 400 files; fixed "invalid relative path: extension/../../.git/config" error (chat-driven)
- 2025-10-15 19:50 — Fixed CI build: vsce not found error — Removed `npm install --production` from package script; CI's earlier `npm ci` already installs devDependencies including @vscode/vsce; production install was excluding vsce and breaking build (chat-driven)
- 2025-10-15 19:45 — Updated CHANGELOG.md with missing entries — Added 9 missing timestamped entries (19:00-19:40) covering same period as DesignWalkthrough updates (chat-driven)
- 2025-10-15 19:40 — Updated DesignWalkthrough.md with missing entries — Added 7 missing entries (Prompts #37-44) covering git operation prohibition, CI fixes, integration test documentation, icon addition, packaging fixes, and LICENSE (chat-driven)
- 2025-10-15 19:35 — Resumed logging all prompts to PromptLog.md — Backfilled missing Entries #38-44 covering CI investigations, integration test question, logo addition, license request, and meta-prompt about logging (chat-driven)
- 2025-10-15 19:30 — Added MIT LICENSE to project — Created LICENSE file at root and packages/extension/LICENSE for marketplace publishing; removed --skip-license flag; verified packaging includes LICENSE.txt with no warnings (chat-driven)
- 2025-10-15 19:25 — Fixed non-interactive packaging for CI — Added --skip-license flag to vsce package command to prevent interactive prompt that blocks CI builds (chat-driven)
- 2025-10-15 19:20 — Added waldo.png as extension icon — Updated extension package.json with icon: "images/waldo.png"; verified packaging includes 34.24KB icon file; final package: 400 files, 888.3KB (chat-driven)
- 2025-10-15 19:15 — Fixed CI build failures: packaging issues — Added npm install --production to package script to fix axios missing dependency; added repository field to extension package.json; fixed broken relative link in README to absolute GitHub URL; created .vscodeignore to exclude src/tests/coverage (reduced package from 435 to 399 files, 934KB to 887KB) (chat-driven)
- 2025-10-15 19:10 — Documented lack of integration tests — All 195 tests (139 MCP + 56 extension) are unit tests with mocked boundaries; integration test infrastructure exists but empty; recommend manual E2E testing first (chat-driven)
- 2025-10-15 19:05 — Fixed CI failure: Added missing test:coverage script to MCP package.json — CI was calling npm run test:coverage which didn't exist; added "test:coverage": "jest --coverage" (chat-driven)
- 2025-10-15 19:00 — Added rule to prohibit automated git operations in Copilot instructions — Agent must never execute git commands (commit, push, pull, merge, etc.) without explicit user request; user maintains full control over repository history (chat-driven)
- 2025-10-15 18:45 — Created GitHub Actions CI/CD workflows (6 workflows + dependabot + labeler) — Automated testing on Node 18.x/20.x, multi-OS extension tests, CodeQL security, dependency review, auto-labeling, marketplace publishing (chat-driven)
- 2025-10-15 18:30 — Created E2E test script for manual testing (docs/E2E-TestScript.md) — Comprehensive testing guide with 10 sections covering workspace setup, MCP lifecycle, queries, caching, edge cases, Copilot integration, and success criteria (chat-driven)
- 2025-10-15 18:00 — Created Jest test suite for VSCode extension (3 test files, 56 tests, 100% coverage on testable modules) — Validates extension logic with unit tests (chat-driven)
- 2025-01-14 17:32 — Created comprehensive test suite for MCP backend (7 test files, 139 tests, 74.64% coverage) — Ensures code quality before manual testing (chat-driven)
- 2025-10-15 17:05 — Created UserGuide.md with 13 sections for end users — documents installation, setup, authentication, querying, saving, references, Copilot integration, configuration, troubleshooting, FAQ (chat-driven)
- 2025-10-15 17:02 — Created monorepo structure — Root package.json with workspaces, tsconfig.json (ES2022+ESM), .gitignore, README.md, packages/mcp (Express+MSAL+Jest), packages/extension (VSCode manifest+settings), component CHANGELOGs (chat-driven)
- 2025-10-15 16:57 — Added SOLID principles and best practices to Copilot instructions — Enforce SRP, OCP, LSP, ISP, DIP, DRY, KISS, YAGNI, type safety, error handling, separation of concerns, and code organization standards (chat-driven)
- 2025-10-15 16:55 — Added development standards to Copilot instructions — Requires tests for all code (MCP + extension), user documentation (UserGuide.md), and component CHANGELOGs with semantic versioning (chat-driven)
- 2025-10-15 16:45 — Added technical implementation specifications to Instructions.md — Documented NL-to-KQL search flow, JSON-RPC protocol, monorepo structure, extension naming, logging, workspace discovery, TypeScript config (chat-driven)
- 2025-10-15 16:35 — Cleaned up Instructions.md — Removed 200+ lines of duplicate and outdated conversational content (chat-driven)
- 2025-10-15 16:30 — Removed outdated "tell me your choices" text from Instructions.md — Cleaned up outdated interactive prompt text; Instructions.md is now complete reference documentation ready for implementation (chat-driven)
- 2025-10-15 16:25 — Finalized implementation decisions in Instructions.md — Documented all architectural choices: file-based cache, device_code auth (primary), few-shot prompting with GitHub Copilot, GitHub API for external references, no embeddings, webview UI, automatic MCP registration, configurable retry count, opt-in PII sanitization, strict .kql format; added new settings and saved query format specification (chat-driven)
- 2025-01-14 17:20 — Scaffolded complete VSCode extension with 3 modules — extension.ts (commands, MCP lifecycle, auto-start), mcpClient.ts (JSON-RPC client with retries), resultsWebview.ts (HTML results display with tables/recommendations) — verified compilation (chat-driven)
- 2025-10-15 15:50 — Added external reference support to Instructions.md — MCP can now fetch KQL examples from GitHub repos and blogs to maximize context for NL-to-KQL translation; added workspace settings, new references.ts module, rate limiting, and caching (chat-driven)
- 2025-10-15 15:35 — Updated Copilot instructions to log ALL prompts immediately — Made prompt logging the first step in workflow; all user interactions (questions, changes, etc.) now logged to PromptLog.md before any other action (chat-driven)
- 2025-10-15 15:25 — Fixed timestamps in PromptLog.md and backfilled missing prompts — Replaced "[Current Time]" placeholders with exact timestamps; added Entry #5 (chat-driven)
- 2025-10-15 15:20 — Updated Copilot instructions to enforce logging ALL user prompts — Made prompt logging mandatory for every change with sequential entry numbers; prompts logged first to enable cross-referencing from DesignWalkthrough.md (chat-driven)
- 2025-10-15 15:10 — Changed saved queries to .kql files and added MCP tool definitions — MCP now discovers and uses saved .kql files as context for NL-to-KQL translation; added explicit MCP tool definitions for Copilot integration (chat-driven)
- 2025-10-15 14:50 — Added prompt logging to Copilot instructions and created `docs/PromptLog.md` — Captures user prompts as metadata with cross-references to DesignWalkthrough.md (chat-driven)
- 2025-10-15 14:45 — Created `.github/copilot-instructions.md` — Instructs Copilot to ask 'why' and log every change to docs (chat-driven)
- 2025-10-15 — Initial full-solution instructions added (see `Instructions.md`).
